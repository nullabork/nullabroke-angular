<div class="h-screen flex flex-col bg-[#1e1e1e] text-[#cccccc]">
  <!-- Top Bar -->
  <header class="flex-none h-9 flex items-center justify-between px-2 bg-[#252526] border-b border-[#3c3c3c]">
    <div class="flex items-center gap-2">
      <a
        routerLink="/filings"
        class="flex items-center justify-center w-7 h-7 text-[#858585] hover:text-[#cccccc] hover:bg-[#3c3c3c]"
        title="Back to search"
      >
        <ng-icon name="lucideArrowLeft" class="text-[16px]" />
      </a>
      <span class="text-[13px] text-[#3c3c3c]">|</span>
      @if (filing()) {
        <span class="text-[13px]">{{ filing()!.companyConformedName }}</span>
        <span class="px-1 py-0 text-[10px] font-medium bg-[#0e639c] text-white">
          {{ filing()!.formType }}
        </span>
      } @else {
        <span class="text-[13px] text-[#858585]">Loading...</span>
      }
    </div>
    <div class="flex items-center gap-1">
      <button
        (click)="toggleSidebar()"
        class="flex items-center justify-center w-7 h-7 text-[#858585] hover:text-[#cccccc] hover:bg-[#3c3c3c]"
        [title]="sidebarOpen() ? 'Hide sidebar' : 'Show sidebar'"
      >
        <ng-icon [name]="sidebarOpen() ? 'lucidePanelLeftClose' : 'lucidePanelLeft'" class="text-[16px]" />
      </button>
      @if (filing()) {
        <a
          [href]="filing()!.absoluteFileUrl"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center w-7 h-7 text-[#858585] hover:text-[#cccccc] hover:bg-[#3c3c3c]"
          title="Open raw filing on SEC.gov"
        >
          <ng-icon name="lucideExternalLink" class="text-[16px]" />
        </a>
      }
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Sidebar -->
    @if (sidebarOpen()) {
      <aside class="w-64 flex-none flex flex-col bg-[#252526] border-r border-[#3c3c3c] overflow-hidden">
        @if (loading()) {
          <div class="flex-1 flex items-center justify-center">
            <ng-icon name="lucideLoader2" class="text-[24px] text-[#858585] animate-spin" />
          </div>
        } @else if (filing()) {
          <div class="flex-1 overflow-y-auto">
            <!-- Filing Info -->
            <div class="border-b border-[#3c3c3c]">
              <button
                (click)="toggleSection('info')"
                class="w-full flex items-center gap-1 px-3 py-2 text-[11px] uppercase tracking-wide text-[#cccccc] hover:bg-[#2a2d2e]"
              >
                <ng-icon [name]="sections().info ? 'lucideChevronDown' : 'lucideChevronRight'" class="text-[12px]" />
                Filing
              </button>
              @if (sections().info) {
                <div class="px-3 pb-2 text-[12px] space-y-1">
                  <div class="text-[#858585]">{{ filing()!.formType }} · {{ formatDate(filing()!.dateFiled) }}</div>
                  <div class="font-mono text-[11px] text-[#6e6e6e]">{{ filing()!.accessionNumber }}</div>
                </div>
              }
            </div>

            <!-- Documents List -->
            <div>
              <button
                (click)="toggleSection('documents')"
                class="w-full flex items-center gap-1 px-3 py-2 text-[11px] uppercase tracking-wide text-[#cccccc] hover:bg-[#2a2d2e]"
              >
                <ng-icon [name]="sections().documents ? 'lucideChevronDown' : 'lucideChevronRight'" class="text-[12px]" />
                Documents ({{ documents().length }})
              </button>
              @if (sections().documents) {
                <div class="pb-2">
                  @for (doc of documents(); track doc.sequence) {
                    <button
                      (click)="selectDocument(doc)"
                      class="w-full flex items-center gap-2 px-3 py-1.5 text-left hover:bg-[#2a2d2e]"
                      [class.bg-[#094771]]="selectedDocument()?.sequence === doc.sequence"
                    >
                      <ng-icon [name]="getDocIcon(doc)" class="text-[14px] text-[#858585] flex-none" />
                      <div class="flex-1 min-w-0">
                        <div class="text-[12px] truncate" [class.text-white]="selectedDocument()?.sequence === doc.sequence">
                          {{ getXbrlReportName(doc) || doc.filename }}
                        </div>
                        @if (getXbrlReportName(doc)) {
                          <div class="text-[10px] text-[#6e6e6e] truncate">{{ doc.filename }}</div>
                        } @else if (doc.description) {
                          <div class="text-[10px] text-[#6e6e6e] truncate">{{ doc.description }}</div>
                        }
                      </div>
                      @if (doc.sequence === 1) {
                        <span class="text-[9px] px-1 bg-[#0e639c] text-white flex-none">PRIMARY</span>
                      }
                      @if (isXbrlDocument(doc)) {
                        <span class="text-[9px] px-1 bg-[#4d3d0a] text-[#d4a843] flex-none">XBRL</span>
                      }
                    </button>
                  }
                </div>
              }
            </div>

            <!-- Company -->
            <div class="border-t border-[#3c3c3c]">
              <button
                (click)="toggleSection('company')"
                class="w-full flex items-center gap-1 px-3 py-2 text-[11px] uppercase tracking-wide text-[#cccccc] hover:bg-[#2a2d2e]"
              >
                <ng-icon [name]="sections().company ? 'lucideChevronDown' : 'lucideChevronRight'" class="text-[12px]" />
                Company
              </button>
              @if (sections().company) {
                <div class="px-3 pb-2 text-[12px]">
                  <div class="text-[#cccccc]">{{ filing()!.companyConformedName }}</div>
                  <div class="text-[#6e6e6e] font-mono text-[11px]">CIK {{ filing()!.centralIndexKey }}</div>
                </div>
              }
            </div>
          </div>
        }
      </aside>
    }

    <!-- Document Viewer (Iframe) -->
    <main class="flex-1 flex flex-col bg-[#1e1e1e] overflow-hidden">
      @if (loading()) {
        <div class="flex-1 flex items-center justify-center">
          <ng-icon name="lucideLoader2" class="text-[32px] text-[#858585] animate-spin" />
        </div>
      } @else if (error()) {
        <div class="flex-1 flex flex-col items-center justify-center text-[#858585]">
          <ng-icon name="lucideAlertCircle" class="text-[48px] text-red-500 mb-3" />
          <p class="text-[15px]">Failed to load filing</p>
          <p class="text-[13px] mt-1 text-[#6e6e6e]">{{ error() }}</p>
        </div>
      } @else if (xbrlMode()) {
        <!-- XBRL Report Viewer -->
        <div class="flex-1 flex flex-col overflow-hidden">
          <!-- Report tabs bar -->
          <div class="flex-none flex items-center gap-1 px-2 py-1.5 bg-[#252526] border-b border-[#3c3c3c] overflow-x-auto">
            @for (report of xbrlReports(); track report.position) {
              <button
                (click)="selectXbrlReport(report)"
                class="px-3 py-1 text-[12px] whitespace-nowrap rounded-sm transition-colors"
                [class]="selectedXbrlReport()?.htmlFileName === report.htmlFileName
                  ? 'bg-[#094771] text-white'
                  : 'text-[#858585] hover:text-[#cccccc] hover:bg-[#3c3c3c]'"
              >
                {{ report.shortName }}
              </button>
            }
          </div>

          <!-- Report content -->
          <div class="flex-1 overflow-auto">
            @if (xbrlLoading()) {
              <div class="flex items-center justify-center h-full">
                <ng-icon name="lucideLoader2" class="text-[32px] text-[#858585] animate-spin" />
              </div>
            } @else if (xbrlReportHtml()) {
              <div class="xbrl-content p-4" [innerHTML]="xbrlReportHtml()"></div>
            } @else {
              <div class="flex-1 flex flex-col items-center justify-center h-full text-[#6e6e6e]">
                <ng-icon name="lucideTable" class="text-[48px] mb-3 opacity-30" />
                <p class="text-[13px]">No XBRL reports found</p>
              </div>
            }
          </div>
        </div>
      } @else if (iframeSrc()) {
        <!-- Document Frame Container -->
        <div class="flex-1 relative overflow-auto bg-white">
          <!-- Loading Overlay -->
          @if (iframeLoading()) {
            <div class="absolute inset-0 flex items-center justify-center bg-white z-10">
              <ng-icon name="lucideLoader2" class="text-[32px] text-[#858585] animate-spin" />
            </div>
          }

          <!-- Iframe -->
          <iframe
            [src]="iframeSrc()"
            (load)="onIframeLoad()"
            class="w-full h-full border-0"
            frameborder="0"
          ></iframe>
        </div>
      } @else if (selectedDocument()) {
        <!-- Placeholder when loading document URL -->
        <div class="flex-1 flex flex-col items-center justify-center text-[#6e6e6e]">
          <ng-icon name="lucideLoader2" class="text-[48px] mb-3 animate-spin" />
          <p class="text-[13px]">Loading document...</p>
        </div>
      } @else {
        <div class="flex-1 flex flex-col items-center justify-center text-[#6e6e6e]">
          <ng-icon name="lucideFile" class="text-[48px] mb-3 opacity-30" />
          <p class="text-[13px]">Select a document from the sidebar</p>
        </div>
      }
    </main>
  </div>

  <!-- Status Bar -->
  <footer class="flex-none h-6 flex items-center justify-between px-3 bg-[#007acc] text-white text-[12px]">
    <div class="flex items-center gap-3">
      @if (xbrlMode() && selectedXbrlReport()) {
        <span>{{ selectedXbrlReport()!.shortName }}</span>
        @if (xbrlLoading()) {
          <span class="text-blue-200">· Loading...</span>
        }
      } @else if (selectedDocument()) {
        <span>{{ selectedDocument()!.filename }}</span>
        @if (iframeLoading()) {
          <span class="text-blue-200">· Loading...</span>
        }
      } @else if (filing()) {
        <span>{{ filing()!.accessionNumber }}</span>
      }
    </div>
    <div class="flex items-center gap-3">
      @if (selectionContext()) {
        <span class="text-blue-200">Text selected</span>
      }
      @if (filing()) {
        <span>{{ formatDate(filing()!.dateFiled) }}</span>
      }
    </div>
  </footer>
</div>
